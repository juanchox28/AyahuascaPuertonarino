(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function e(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(o){if(o.ep)return;o.ep=!0;const i=e(o);fetch(o.href,i)}})();class r{constructor(){this.rooms=[],this.selectedRooms={},this.totalGuests=0,this.totalPrice=0,this.checkInDate=null,this.checkOutDate=null,this.nights=0,this.baseURL=window.location.origin,this.init()}async init(){await this.loadRooms(),this.setupEventListeners(),this.setupDateValidation(),this.checkBackendHealth()}async checkBackendHealth(){try{const e=await(await fetch(`${this.baseURL}/health`)).json();console.log("Backend health:",e),e.has_private_key||console.warn("Wompi private key not configured. Payments will fail.")}catch(t){console.error("Backend health check failed:",t)}}async loadRooms(){try{this.rooms=[{id:"dormitorio",name:"Cama en Dormitorio",price:5e4,capacity:1,image:"https://conexion-amazonas.com/wp-content/uploads/2025/05/DSCF0164-scaled.jpg",description:"Domritorio Compartido x 4 camas"},{id:"sencilla pvt",name:"Sencilla Privada",price:7e4,capacity:1,image:"https://conexion-amazonas.com/wp-content/uploads/2025/05/DSCF0150-1-scaled.jpg",description:"Habitacion privada para una persona"},{id:"Matrimonial Deluxe",name:"Habitación Deluxe",price:12e4,capacity:2,image:"https://conexion-amazonas.com/wp-content/uploads/2025/05/IMG_20250427_105039882_HDR-1-scaled.jpg",description:"suite para 2 personas"},{id:"triple-familiar",name:"Suite Familiar",price:135e3,capacity:3,image:"https://conexion-amazonas.com/wp-content/uploads/2025/05/DSCF02342-1-scaled.jpg",description:"Espaciosa suite para familias"},{id:"cuadruple-familiar",name:"Suite Familiar ",price:15e4,capacity:4,image:"https://conexion-amazonas.com/wp-content/uploads/2025/05/DSCF02342-1-scaled.jpg",description:"Suite con cama matrimonial+ 2 camas sencillas"},{id:"Matrimonial+hamaca",name:"Matrimonial con vista al rio y Hamaca",price:13e4,capacity:2,image:"https://conexion-amazonas.com/wp-content/uploads/2025/05/DSCF0202-1-scaled.jpg",description:"La suite más exclusiva del hotel"},{id:"Doble",name:"Suite Doble Sencilla",price:11e4,capacity:2,image:"https://conexion-amazonas.com/wp-content/uploads/2025/05/DSCF02382-scaled.jpg",description:"Suite con dos camas sencillas"}]}catch(t){console.error("Error loading rooms:",t)}}setupEventListeners(){const t=document.getElementById("dateForm");t&&t.addEventListener("submit",o=>this.handleDateFormSubmit(o)),document.addEventListener("click",o=>{o.target.classList.contains("quantity-btn")&&this.handleQuantityChange(o)}),document.addEventListener("input",o=>{o.target.classList.contains("quantity-input")&&this.handleInputChange(o)}),setTimeout(()=>{const o=document.getElementById("bookingForm");o&&o.addEventListener("submit",i=>this.handleSubmit(i))},100),setTimeout(()=>{const o=document.querySelector(".close"),i=document.getElementById("cancelPayment"),a=document.getElementById("goToPayment");o&&o.addEventListener("click",()=>this.hideModal()),i&&i.addEventListener("click",()=>this.hideModal()),a&&a.addEventListener("click",()=>this.proceedToPayment())},100);const e=document.getElementById("checkIn"),n=document.getElementById("checkOut");e&&(e.addEventListener("click",()=>this.openDatePicker("checkIn")),e.addEventListener("change",()=>this.updateCheckoutMinDate())),n&&n.addEventListener("click",()=>this.openDatePicker("checkOut"))}setupDateValidation(){const t=new Date().toISOString().split("T")[0],e=document.getElementById("checkIn"),n=document.getElementById("checkOut");e&&(e.min=t),n&&(n.min=t)}updateCheckoutMinDate(){const t=document.getElementById("checkIn"),e=document.getElementById("checkOut");if(t.value&&e){const n=new Date(t.value),o=new Date(n);o.setDate(n.getDate()+1),e.min=o.toISOString().split("T")[0],e.value&&new Date(e.value)<=n&&(e.value="")}}openDatePicker(t){const e=document.getElementById(t);e&&e.showPicker()}handleDateFormSubmit(t){t.preventDefault();const e=new FormData(t.target),n=Object.fromEntries(e);if(this.checkInDate=new Date(n.checkIn),this.checkOutDate=new Date(n.checkOut),this.totalGuests=parseInt(n.totalGuests),this.checkOutDate<=this.checkInDate){alert("La fecha de check-out debe ser posterior al check-in");return}this.nights=Math.ceil((this.checkOutDate-this.checkInDate)/(1e3*60*60*24)),this.showRoomsSection(),this.displayRooms()}showRoomsSection(){const t=document.getElementById("dateSelectionSection"),e=document.getElementById("roomsSection");t&&e&&(t.classList.add("hidden"),e.classList.remove("hidden"),e.scrollIntoView({behavior:"smooth"}))}displayRooms(){const t=document.getElementById("roomsGrid");t&&(t.innerHTML="",this.rooms.forEach(e=>{const n=document.createElement("div");n.className="room-card",n.innerHTML=`
                <div class="room-image">
                    <img src="${e.image}" alt="${e.name}" loading="lazy">
                </div>
                <div class="room-info">
                    <h4>${e.name}</h4>
                    <div class="room-description">${e.description}</div>
                    <div class="room-price">$${e.price.toLocaleString()} COP/noche</div>
                    <div class="room-capacity">Capacidad máxima: ${e.capacity} persona(s)</div>
                    <div class="room-quantity">
                        <label>Cantidad:</label>
                        <div class="quantity-controls">
                            <button type="button" class="quantity-btn minus" data-room="${e.id}">-</button>
                            <input type="number" id="quantity-${e.id}" class="quantity-input" 
                                   min="0" max="10" value="0" data-room="${e.id}" data-capacity="${e.capacity}">
                            <button type="button" class="quantity-btn plus" data-room="${e.id}">+</button>
                        </div>
                    </div>
                </div>
            `,t.appendChild(n)}))}handleQuantityChange(t){const e=t.target.dataset.room,n=document.getElementById(`quantity-${e}`),o=parseInt(n.value),i=this.rooms.find(a=>a.id===e);t.target.classList.contains("plus")?n.value=o+1:t.target.classList.contains("minus")&&o>0&&(n.value=o-1),this.updateRoomSelection(e,parseInt(n.value),i.capacity)}handleInputChange(t){const e=t.target.dataset.room,n=parseInt(t.target.dataset.capacity);let o=parseInt(t.target.value)||0;o<0&&(o=0,t.target.value=0),this.updateRoomSelection(e,o,n)}updateRoomSelection(t,e,n){e>0?this.selectedRooms[t]={quantity:e,capacity:n,room:this.rooms.find(o=>o.id===t)}:delete this.selectedRooms[t],this.updateSummary()}updateSummary(){this.calculateTotals(),this.updateUI(),this.validateSelection()}calculateTotals(){let t=0,e=0;Object.values(this.selectedRooms).forEach(n=>{t+=n.quantity*n.capacity,e+=n.quantity*n.room.price}),this.totalSelectedGuests=t,this.nightlyPrice=e,this.totalPrice=this.nights*e}updateUI(){const t=document.getElementById("selectedRoomsSummary"),e=document.getElementById("totalSelectedGuests"),n=document.getElementById("totalNightlyPrice");if(!t||!e||!n)return;if(Object.keys(this.selectedRooms).length===0){t.innerHTML="No has seleccionado habitaciones",e.textContent="Total huéspedes seleccionados: 0",n.textContent="Precio por noche: $0 COP";return}let o="<ul>";Object.entries(this.selectedRooms).forEach(([i,a])=>{const c=a.room;o+=`
                <li>
                    ${a.quantity}x ${c.name} - ${a.quantity*a.capacity} huéspedes
                </li>
            `}),o+="</ul>",t.innerHTML=o,e.textContent=`Total huéspedes seleccionados: ${this.totalSelectedGuests}`,n.textContent=`Precio por noche: $${this.nightlyPrice.toLocaleString()} COP`,this.totalSelectedGuests>=this.totalGuests&&this.showBookingForm()}validateSelection(){this.totalSelectedGuests>this.totalGuests&&alert(`Has seleccionado ${this.totalSelectedGuests} huéspedes pero solo necesitas ${this.totalGuests}. Por favor ajusta tu selección.`)}showBookingForm(){const t=document.getElementById("roomsSection"),e=document.getElementById("bookingFormSection"),n=document.getElementById("finalGuests"),o=document.getElementById("bookingDates"),i=document.getElementById("bookingNights"),a=document.getElementById("priceDisplay");t&&e&&n&&o&&i&&a&&(t.classList.add("hidden"),e.classList.remove("hidden"),n.value=this.totalSelectedGuests,o.textContent=`Fechas: ${this.checkInDate.toLocaleDateString()} - ${this.checkOutDate.toLocaleDateString()}`,i.textContent=`Noches: ${this.nights}`,a.textContent=`$${this.totalPrice.toLocaleString()} COP`,this.updateBookingFormSummary(),e.scrollIntoView({behavior:"smooth"}))}updateBookingFormSummary(){const t=document.getElementById("selectedRoomsReview");if(!t)return;let e="<h5>Habitaciones seleccionadas:</h5><ul>";Object.entries(this.selectedRooms).forEach(([n,o])=>{const i=o.room,a=o.quantity*i.price*this.nights;e+=`
                <li>
                    ${o.quantity}x ${i.name} - $${a.toLocaleString()} COP
                </li>
            `}),e+="</ul>",t.innerHTML=e}async handleSubmit(t){t.preventDefault();const e=new FormData(t.target),n=Object.fromEntries(e),o={name:n.name,email:n.email,amount:this.totalPrice,checkIn:this.checkInDate.toISOString().split("T")[0],checkOut:this.checkOutDate.toISOString().split("T")[0],guests:this.totalSelectedGuests,room:Object.keys(this.selectedRooms).map(i=>({roomId:i,quantity:this.selectedRooms[i].quantity}))};try{const a=await(await fetch(`${this.baseURL}/api/create-booking`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)})).json();a.ok?this.showModal(a):(alert("Error al crear la reserva: "+(a.error||"Error desconocido")),console.error("Booking error:",a))}catch(i){console.error("Error:",i),alert("Error al conectar con el servidor. Por favor verifica que el backend esté ejecutándose.")}}showModal(t){const e=document.getElementById("modal"),n=document.getElementById("modalMessage"),o=document.getElementById("goToPayment");!e||!n||!o||(t.checkout_url?(n.innerHTML=`
                <p>Reserva creada exitosamente. Referencia: <strong>${t.booking.reference}</strong></p>
                <p>Total: <strong>$${t.booking.amount.toLocaleString()} COP</strong></p>
                <p>Serás redirigido a Wompi para completar el pago.</p>
            `,this.paymentUrl=t.checkout_url):(n.innerHTML=`
                <p>Error al generar el link de pago. Por favor contacta al soporte.</p>
                <p>Referencia: <strong>${t.booking.reference}</strong></p>
                <p>Error: ${t.error||"Error desconocido"}</p>
            `,o.style.display="none"),e.classList.remove("hidden"))}hideModal(){const t=document.getElementById("modal"),e=document.getElementById("goToPayment");t&&t.classList.add("hidden"),e&&(e.style.display="block")}proceedToPayment(){if(this.paymentUrl){window.open(this.paymentUrl,"_blank"),this.hideModal();const t=document.getElementById("bookingForm"),e=document.getElementById("dateForm");t&&t.reset(),e&&e.reset(),this.selectedRooms={},this.totalGuests=0,this.totalPrice=0,this.checkInDate=null,this.checkOutDate=null,this.nights=0;const n=document.getElementById("dateSelectionSection"),o=document.getElementById("roomsSection"),i=document.getElementById("bookingFormSection");n&&n.classList.remove("hidden"),o&&o.classList.add("hidden"),i&&i.classList.add("hidden")}}}document.addEventListener("DOMContentLoaded",()=>{new r});
