(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(o){if(o.ep)return;o.ep=!0;const i=t(o);fetch(o.href,i)}})();class r{constructor(){this.rooms=[],this.selectedRooms={},this.totalGuests=0,this.totalPrice=0,this.checkInDate=null,this.checkOutDate=null,this.nights=0,this.init()}async init(){await this.loadRooms(),this.setupEventListeners(),this.setupDateValidation(),this.checkBackendHealth()}async checkBackendHealth(){try{const t=await(await fetch("http://localhost:3000/health")).json();console.log("Backend health:",t),t.has_private_key||console.warn("Wompi private key not configured. Payments will fail.")}catch(e){console.error("Backend health check failed:",e)}}async loadRooms(){try{this.rooms=[{id:"dormitorio",name:"Cama en Dormitorio",price:5e4,capacity:1,image:"https://conexion-amazonas.com/wp-content/uploads/2025/05/DSCF0164-scaled.jpg",description:"Domritorio Compartido x 4 camas"},{id:"sencilla pvt",name:"Sencilla Privada",price:7e4,capacity:1,image:"https://conexion-amazonas.com/wp-content/uploads/2025/05/DSCF0150-1-scaled.jpg",description:"Habitacion privada para una persona"},{id:"Matrimonial Deluxe",name:"Habitación Deluxe",price:12e4,capacity:2,image:"https://conexion-amazonas.com/wp-content/uploads/2025/05/IMG_20250427_105039882_HDR-1-scaled.jpg",description:"suite para 2 personas"},{id:"triple-familiar",name:"Suite Familiar",price:135e3,capacity:3,image:"https://conexion-amazonas.com/wp-content/uploads/2025/05/DSCF02342-1-scaled.jpg",description:"Espaciosa suite para familias"},{id:"cuadruple-familiar",name:"Suite Familiar ",price:15e4,capacity:4,image:"https://conexion-amazonas.com/wp-content/uploads/2025/05/DSCF02342-1-scaled.jpg",description:"Suite con cama matrimonial+ 2 camas sencillas"},{id:"Matrimonial+hamaca",name:"Matrimonial con vista al rio y Hamaca",price:13e4,capacity:2,image:"https://conexion-amazonas.com/wp-content/uploads/2025/05/DSCF0202-1-scaled.jpg",description:"La suite más exclusiva del hotel"},{id:"Doble",name:"Suite Doble Sencilla",price:11e4,capacity:2,image:"https://conexion-amazonas.com/wp-content/uploads/2025/05/DSCF02382-scaled.jpg",description:"Suite con dos camas sencillas"}]}catch(e){console.error("Error loading rooms:",e)}}setupEventListeners(){const e=document.getElementById("dateForm");e&&e.addEventListener("submit",o=>this.handleDateFormSubmit(o)),document.addEventListener("click",o=>{o.target.classList.contains("quantity-btn")&&this.handleQuantityChange(o)}),document.addEventListener("input",o=>{o.target.classList.contains("quantity-input")&&this.handleInputChange(o)}),setTimeout(()=>{const o=document.getElementById("bookingForm");o&&o.addEventListener("submit",i=>this.handleSubmit(i))},100),setTimeout(()=>{const o=document.querySelector(".close"),i=document.getElementById("cancelPayment"),a=document.getElementById("goToPayment");o&&o.addEventListener("click",()=>this.hideModal()),i&&i.addEventListener("click",()=>this.hideModal()),a&&a.addEventListener("click",()=>this.proceedToPayment())},100);const t=document.getElementById("checkIn"),n=document.getElementById("checkOut");t&&(t.addEventListener("click",()=>this.openDatePicker("checkIn")),t.addEventListener("change",()=>this.updateCheckoutMinDate())),n&&n.addEventListener("click",()=>this.openDatePicker("checkOut"))}setupDateValidation(){const e=new Date().toISOString().split("T")[0],t=document.getElementById("checkIn"),n=document.getElementById("checkOut");t&&(t.min=e),n&&(n.min=e)}updateCheckoutMinDate(){const e=document.getElementById("checkIn"),t=document.getElementById("checkOut");if(e.value&&t){const n=new Date(e.value),o=new Date(n);o.setDate(n.getDate()+1),t.min=o.toISOString().split("T")[0],t.value&&new Date(t.value)<=n&&(t.value="")}}openDatePicker(e){const t=document.getElementById(e);t&&t.showPicker()}handleDateFormSubmit(e){e.preventDefault();const t=new FormData(e.target),n=Object.fromEntries(t);if(this.checkInDate=new Date(n.checkIn),this.checkOutDate=new Date(n.checkOut),this.totalGuests=parseInt(n.totalGuests),this.checkOutDate<=this.checkInDate){alert("La fecha de check-out debe ser posterior al check-in");return}this.nights=Math.ceil((this.checkOutDate-this.checkInDate)/(1e3*60*60*24)),this.showRoomsSection(),this.displayRooms()}showRoomsSection(){const e=document.getElementById("dateSelectionSection"),t=document.getElementById("roomsSection");e&&t&&(e.classList.add("hidden"),t.classList.remove("hidden"),t.scrollIntoView({behavior:"smooth"}))}displayRooms(){const e=document.getElementById("roomsGrid");e&&(e.innerHTML="",this.rooms.forEach(t=>{const n=document.createElement("div");n.className="room-card",n.innerHTML=`
                <div class="room-image">
                    <img src="${t.image}" alt="${t.name}" loading="lazy">
                </div>
                <div class="room-info">
                    <h4>${t.name}</h4>
                    <div class="room-description">${t.description}</div>
                    <div class="room-price">$${t.price.toLocaleString()} COP/noche</div>
                    <div class="room-capacity">Capacidad máxima: ${t.capacity} persona(s)</div>
                    <div class="room-quantity">
                        <label>Cantidad:</label>
                        <div class="quantity-controls">
                            <button type="button" class="quantity-btn minus" data-room="${t.id}">-</button>
                            <input type="number" id="quantity-${t.id}" class="quantity-input" 
                                   min="0" max="10" value="0" data-room="${t.id}" data-capacity="${t.capacity}">
                            <button type="button" class="quantity-btn plus" data-room="${t.id}">+</button>
                        </div>
                    </div>
                </div>
            `,e.appendChild(n)}))}handleQuantityChange(e){const t=e.target.dataset.room,n=document.getElementById(`quantity-${t}`),o=parseInt(n.value),i=this.rooms.find(a=>a.id===t);e.target.classList.contains("plus")?n.value=o+1:e.target.classList.contains("minus")&&o>0&&(n.value=o-1),this.updateRoomSelection(t,parseInt(n.value),i.capacity)}handleInputChange(e){const t=e.target.dataset.room,n=parseInt(e.target.dataset.capacity);let o=parseInt(e.target.value)||0;o<0&&(o=0,e.target.value=0),this.updateRoomSelection(t,o,n)}updateRoomSelection(e,t,n){t>0?this.selectedRooms[e]={quantity:t,capacity:n,room:this.rooms.find(o=>o.id===e)}:delete this.selectedRooms[e],this.updateSummary()}updateSummary(){this.calculateTotals(),this.updateUI(),this.validateSelection()}calculateTotals(){let e=0,t=0;Object.values(this.selectedRooms).forEach(n=>{e+=n.quantity*n.capacity,t+=n.quantity*n.room.price}),this.totalSelectedGuests=e,this.nightlyPrice=t,this.totalPrice=this.nights*t}updateUI(){const e=document.getElementById("selectedRoomsSummary"),t=document.getElementById("totalSelectedGuests"),n=document.getElementById("totalNightlyPrice");if(!e||!t||!n)return;if(Object.keys(this.selectedRooms).length===0){e.innerHTML="No has seleccionado habitaciones",t.textContent="Total huéspedes seleccionados: 0",n.textContent="Precio por noche: $0 COP";return}let o="<ul>";Object.entries(this.selectedRooms).forEach(([i,a])=>{const c=a.room;o+=`
                <li>
                    ${a.quantity}x ${c.name} - ${a.quantity*a.capacity} huéspedes
                </li>
            `}),o+="</ul>",e.innerHTML=o,t.textContent=`Total huéspedes seleccionados: ${this.totalSelectedGuests}`,n.textContent=`Precio por noche: $${this.nightlyPrice.toLocaleString()} COP`,this.totalSelectedGuests>=this.totalGuests&&this.showBookingForm()}validateSelection(){this.totalSelectedGuests>this.totalGuests&&alert(`Has seleccionado ${this.totalSelectedGuests} huéspedes pero solo necesitas ${this.totalGuests}. Por favor ajusta tu selección.`)}showBookingForm(){const e=document.getElementById("roomsSection"),t=document.getElementById("bookingFormSection"),n=document.getElementById("finalGuests"),o=document.getElementById("bookingDates"),i=document.getElementById("bookingNights"),a=document.getElementById("priceDisplay");e&&t&&n&&o&&i&&a&&(e.classList.add("hidden"),t.classList.remove("hidden"),n.value=this.totalSelectedGuests,o.textContent=`Fechas: ${this.checkInDate.toLocaleDateString()} - ${this.checkOutDate.toLocaleDateString()}`,i.textContent=`Noches: ${this.nights}`,a.textContent=`$${this.totalPrice.toLocaleString()} COP`,this.updateBookingFormSummary(),t.scrollIntoView({behavior:"smooth"}))}updateBookingFormSummary(){const e=document.getElementById("selectedRoomsReview");if(!e)return;let t="<h5>Habitaciones seleccionadas:</h5><ul>";Object.entries(this.selectedRooms).forEach(([n,o])=>{const i=o.room,a=o.quantity*i.price*this.nights;t+=`
                <li>
                    ${o.quantity}x ${i.name} - $${a.toLocaleString()} COP
                </li>
            `}),t+="</ul>",e.innerHTML=t}async handleSubmit(e){e.preventDefault();const t=new FormData(e.target),n=Object.fromEntries(t),o={name:n.name,email:n.email,amount:this.totalPrice,checkIn:this.checkInDate.toISOString().split("T")[0],checkOut:this.checkOutDate.toISOString().split("T")[0],guests:this.totalSelectedGuests,room:Object.keys(this.selectedRooms).map(i=>({roomId:i,quantity:this.selectedRooms[i].quantity}))};try{const a=await(await fetch("http://localhost:3000/api/create-booking",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)})).json();a.ok?this.showModal(a):(alert("Error al crear la reserva: "+(a.error||"Error desconocido")),console.error("Booking error:",a))}catch(i){console.error("Error:",i),alert("Error al conectar con el servidor. Por favor verifica que el backend esté ejecutándose.")}}showModal(e){const t=document.getElementById("modal"),n=document.getElementById("modalMessage"),o=document.getElementById("goToPayment");!t||!n||!o||(e.checkout_url?(n.innerHTML=`
                <p>Reserva creada exitosamente. Referencia: <strong>${e.booking.reference}</strong></p>
                <p>Total: <strong>$${e.booking.amount.toLocaleString()} COP</strong></p>
                <p>Serás redirigido a Wompi para completar el pago.</p>
            `,this.paymentUrl=e.checkout_url):(n.innerHTML=`
                <p>Error al generar el link de pago. Por favor contacta al soporte.</p>
                <p>Referencia: <strong>${e.booking.reference}</strong></p>
                <p>Error: ${e.error||"Error desconocido"}</p>
            `,o.style.display="none"),t.classList.remove("hidden"))}hideModal(){const e=document.getElementById("modal"),t=document.getElementById("goToPayment");e&&e.classList.add("hidden"),t&&(t.style.display="block")}proceedToPayment(){if(this.paymentUrl){window.open(this.paymentUrl,"_blank"),this.hideModal();const e=document.getElementById("bookingForm"),t=document.getElementById("dateForm");e&&e.reset(),t&&t.reset(),this.selectedRooms={},this.totalGuests=0,this.totalPrice=0,this.checkInDate=null,this.checkOutDate=null,this.nights=0;const n=document.getElementById("dateSelectionSection"),o=document.getElementById("roomsSection"),i=document.getElementById("bookingFormSection");n&&n.classList.remove("hidden"),o&&o.classList.add("hidden"),i&&i.classList.add("hidden")}}}document.addEventListener("DOMContentLoaded",()=>{new r});
